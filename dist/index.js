'use strict';var _express=require('express');var _express2=_interopRequireDefault(_express);var _serveFavicon=require('serve-favicon');var _serveFavicon2=_interopRequireDefault(_serveFavicon);var _morgan=require('morgan');var _morgan2=_interopRequireDefault(_morgan);var _cookieParser=require('cookie-parser');var _cookieParser2=_interopRequireDefault(_cookieParser);var _bodyParser=require('body-parser');var _bodyParser2=_interopRequireDefault(_bodyParser);var _debug=require('debug');var _debug2=_interopRequireDefault(_debug);var _fs=require('fs');var _fs2=_interopRequireDefault(_fs);var _path=require('path');var _path2=_interopRequireDefault(_path);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var app=(0,_express2.default)(),debugDev=(0,_debug2.default)('dev');app.set('views','views');app.set('view engine','ejs');app.use((0,_morgan2.default)('dev'));app.use(_bodyParser2.default.json({limit:'5mb'}));app.use(_bodyParser2.default.urlencoded({extended:false}));app.use((0,_cookieParser2.default)());app.use(_express2.default.static('public'));app.use((0,_serveFavicon2.default)('favicon.ico'));// Route to display pre-rendered static HTML
app.get('/:version',function(req,res){res.sendFile(req.params.version+'.html',{root:_path2.default.join(__dirname,'../public/html')},function(err){if(err){/* TODO: Provide 404 view */}});});// Route to render static HTML from JSON content and save file
app.post('/:version/generate-html',function(req,res){var versionNumber=req.params.version;var json=req.body;var normalizedData=[];var sections={'Themes':{},'Subatomic':{},'Atoms':{},'Molecules':{},'Organisms':{},'Utilities':{},'Third-Party':{}};// Normalize to flat array of Objects
json.map(function(item){var newItem={description:item.description};item.tags.map(function(tag){var tagKey=tag.tag;var tagValue=tag.description;newItem[tagKey]=tagValue;});normalizedData.push(newItem);});// Place items in sections
normalizedData.map(function(item){var section=sections[item.section];var component=section[item.parentComponent];// Top level items within sections
if(item.name===item.parentComponent){section[item.name]=item;}else{// Sub-items
if(!component.children)component.children={};component.children[item.name]=item;}});// Write static HTML file from rendered template string
res.render('pages/index',{versionNumber:versionNumber,sections:sections},function(err,html){_fs2.default.writeFile('public/html/'+versionNumber+'.html',html,function(err){if(err){res.status(500).send('Unable to save static HTML file.');throw err;}else res.status(200).send('Saved file \''+versionNumber+'.html\'.');});});});var port=8080;app.listen(port);debugDev('App running on port '+port+'.');